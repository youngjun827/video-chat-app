{"ast":null,"code":"import io from\"socket.io-client\";import{setPendingFriendsInvitations,setFriends,setOnlineUsers}from\"../store/actions/friendsActions\";import store from\"../store/store\";import{updateDirectChatHistoryIfActive}from\"../shared/utils/chat\";import*as roomHandler from\"./roomHandler\";import*as webRTCHandler from\"./webRTCHandler\";var socket=null;export var connectWithSocketServer=function connectWithSocketServer(userDetails){var jwtToken=userDetails.token;socket=io(\"http://localhost:5002\",{auth:{token:jwtToken}});socket.on(\"connect\",function(){console.log(\"succesfully connected with socket.io server\");console.log(socket.id);});socket.on(\"friends-invitations\",function(data){var pendingInvitations=data.pendingInvitations;store.dispatch(setPendingFriendsInvitations(pendingInvitations));});socket.on(\"friends-list\",function(data){var friends=data.friends;store.dispatch(setFriends(friends));});socket.on(\"online-users\",function(data){var onlineUsers=data.onlineUsers;store.dispatch(setOnlineUsers(onlineUsers));});socket.on(\"direct-chat-history\",function(data){console.log(data);updateDirectChatHistoryIfActive(data);});socket.on(\"room-create\",function(data){roomHandler.newRoomCreated(data);});socket.on(\"active-rooms\",function(data){roomHandler.updateActiveRooms(data);});socket.on(\"conn-prepare\",function(data){var connUserSocketId=data.connUserSocketId;webRTCHandler.prepareNewPeerConnection(connUserSocketId,false);socket.emit(\"conn-init\",{connUserSocketId:connUserSocketId});});socket.on(\"conn-init\",function(data){var connUserSocketId=data.connUserSocketId;webRTCHandler.prepareNewPeerConnection(connUserSocketId,true);});socket.on(\"conn-signal\",function(data){webRTCHandler.handleSignalingData(data);});socket.on(\"room-participant-left\",function(data){console.log(\"user left room\");webRTCHandler.handleParticipantLeftRoom(data);});};export var sendDirectMessage=function sendDirectMessage(data){console.log(data);socket.emit(\"direct-message\",data);};export var getDirectChatHistory=function getDirectChatHistory(data){socket.emit(\"direct-chat-history\",data);};export var createNewRoom=function createNewRoom(){socket.emit(\"room-create\");};export var joinRoom=function joinRoom(data){socket.emit(\"room-join\",data);};export var leaveRoom=function leaveRoom(data){socket.emit(\"room-leave\",data);};export var signalPeerData=function signalPeerData(data){socket.emit(\"conn-signal\",data);};","map":{"version":3,"names":["io","setPendingFriendsInvitations","setFriends","setOnlineUsers","store","updateDirectChatHistoryIfActive","roomHandler","webRTCHandler","socket","connectWithSocketServer","userDetails","jwtToken","token","auth","on","console","log","id","data","pendingInvitations","dispatch","friends","onlineUsers","newRoomCreated","updateActiveRooms","connUserSocketId","prepareNewPeerConnection","emit","handleSignalingData","handleParticipantLeftRoom","sendDirectMessage","getDirectChatHistory","createNewRoom","joinRoom","leaveRoom","signalPeerData"],"sources":["/Users/youngjun827/dev/discord-app/discord-frontend/src/realtimeCommunication/socketConnection.js"],"sourcesContent":["import io from \"socket.io-client\";\r\nimport {\r\n  setPendingFriendsInvitations,\r\n  setFriends,\r\n  setOnlineUsers,\r\n} from \"../store/actions/friendsActions\";\r\nimport store from \"../store/store\";\r\nimport { updateDirectChatHistoryIfActive } from \"../shared/utils/chat\";\r\nimport * as roomHandler from \"./roomHandler\";\r\nimport * as webRTCHandler from \"./webRTCHandler\";\r\n\r\nlet socket = null;\r\n\r\nexport const connectWithSocketServer = (userDetails) => {\r\n  const jwtToken = userDetails.token;\r\n\r\n  socket = io(\"http://localhost:5002\", {\r\n    auth: {\r\n      token: jwtToken,\r\n    },\r\n  });\r\n\r\n  socket.on(\"connect\", () => {\r\n    console.log(\"succesfully connected with socket.io server\");\r\n    console.log(socket.id);\r\n  });\r\n\r\n  socket.on(\"friends-invitations\", (data) => {\r\n    const { pendingInvitations } = data;\r\n    store.dispatch(setPendingFriendsInvitations(pendingInvitations));\r\n  });\r\n\r\n  socket.on(\"friends-list\", (data) => {\r\n    const { friends } = data;\r\n    store.dispatch(setFriends(friends));\r\n  });\r\n\r\n  socket.on(\"online-users\", (data) => {\r\n    const { onlineUsers } = data;\r\n    store.dispatch(setOnlineUsers(onlineUsers));\r\n  });\r\n\r\n  socket.on(\"direct-chat-history\", (data) => {\r\n    console.log(data);\r\n    updateDirectChatHistoryIfActive(data);\r\n  });\r\n\r\n  socket.on(\"room-create\", (data) => {\r\n    roomHandler.newRoomCreated(data);\r\n  });\r\n\r\n  socket.on(\"active-rooms\", (data) => {\r\n    roomHandler.updateActiveRooms(data);\r\n  });\r\n\r\n  socket.on(\"conn-prepare\", (data) => {\r\n    const { connUserSocketId } = data;\r\n    webRTCHandler.prepareNewPeerConnection(connUserSocketId, false);\r\n    socket.emit(\"conn-init\", { connUserSocketId: connUserSocketId });\r\n  });\r\n\r\n  socket.on(\"conn-init\", (data) => {\r\n    const { connUserSocketId } = data;\r\n    webRTCHandler.prepareNewPeerConnection(connUserSocketId, true);\r\n  });\r\n\r\n  socket.on(\"conn-signal\", (data) => {\r\n    webRTCHandler.handleSignalingData(data);\r\n  });\r\n\r\n  socket.on(\"room-participant-left\", (data) => {\r\n    console.log(\"user left room\");\r\n    webRTCHandler.handleParticipantLeftRoom(data);\r\n  });\r\n};\r\n\r\nexport const sendDirectMessage = (data) => {\r\n  console.log(data);\r\n  socket.emit(\"direct-message\", data);\r\n};\r\n\r\nexport const getDirectChatHistory = (data) => {\r\n  socket.emit(\"direct-chat-history\", data);\r\n};\r\n\r\nexport const createNewRoom = () => {\r\n  socket.emit(\"room-create\");\r\n};\r\n\r\nexport const joinRoom = (data) => {\r\n  socket.emit(\"room-join\", data);\r\n};\r\n\r\nexport const leaveRoom = (data) => {\r\n  socket.emit(\"room-leave\", data);\r\n};\r\n\r\nexport const signalPeerData = (data) => {\r\n  socket.emit(\"conn-signal\", data);\r\n};\r\n"],"mappings":"AAAA,MAAOA,GAAP,KAAe,kBAAf,CACA,OACEC,4BADF,CAEEC,UAFF,CAGEC,cAHF,KAIO,iCAJP,CAKA,MAAOC,MAAP,KAAkB,gBAAlB,CACA,OAASC,+BAAT,KAAgD,sBAAhD,CACA,MAAO,GAAKC,YAAZ,KAA6B,eAA7B,CACA,MAAO,GAAKC,cAAZ,KAA+B,iBAA/B,CAEA,GAAIC,OAAM,CAAG,IAAb,CAEA,MAAO,IAAMC,wBAAuB,CAAG,QAA1BA,wBAA0B,CAACC,WAAD,CAAiB,CACtD,GAAMC,SAAQ,CAAGD,WAAW,CAACE,KAA7B,CAEAJ,MAAM,CAAGR,EAAE,CAAC,uBAAD,CAA0B,CACnCa,IAAI,CAAE,CACJD,KAAK,CAAED,QADH,CAD6B,CAA1B,CAAX,CAMAH,MAAM,CAACM,EAAP,CAAU,SAAV,CAAqB,UAAM,CACzBC,OAAO,CAACC,GAAR,CAAY,6CAAZ,EACAD,OAAO,CAACC,GAAR,CAAYR,MAAM,CAACS,EAAnB,EACD,CAHD,EAKAT,MAAM,CAACM,EAAP,CAAU,qBAAV,CAAiC,SAACI,IAAD,CAAU,CACzC,GAAQC,mBAAR,CAA+BD,IAA/B,CAAQC,kBAAR,CACAf,KAAK,CAACgB,QAAN,CAAenB,4BAA4B,CAACkB,kBAAD,CAA3C,EACD,CAHD,EAKAX,MAAM,CAACM,EAAP,CAAU,cAAV,CAA0B,SAACI,IAAD,CAAU,CAClC,GAAQG,QAAR,CAAoBH,IAApB,CAAQG,OAAR,CACAjB,KAAK,CAACgB,QAAN,CAAelB,UAAU,CAACmB,OAAD,CAAzB,EACD,CAHD,EAKAb,MAAM,CAACM,EAAP,CAAU,cAAV,CAA0B,SAACI,IAAD,CAAU,CAClC,GAAQI,YAAR,CAAwBJ,IAAxB,CAAQI,WAAR,CACAlB,KAAK,CAACgB,QAAN,CAAejB,cAAc,CAACmB,WAAD,CAA7B,EACD,CAHD,EAKAd,MAAM,CAACM,EAAP,CAAU,qBAAV,CAAiC,SAACI,IAAD,CAAU,CACzCH,OAAO,CAACC,GAAR,CAAYE,IAAZ,EACAb,+BAA+B,CAACa,IAAD,CAA/B,CACD,CAHD,EAKAV,MAAM,CAACM,EAAP,CAAU,aAAV,CAAyB,SAACI,IAAD,CAAU,CACjCZ,WAAW,CAACiB,cAAZ,CAA2BL,IAA3B,EACD,CAFD,EAIAV,MAAM,CAACM,EAAP,CAAU,cAAV,CAA0B,SAACI,IAAD,CAAU,CAClCZ,WAAW,CAACkB,iBAAZ,CAA8BN,IAA9B,EACD,CAFD,EAIAV,MAAM,CAACM,EAAP,CAAU,cAAV,CAA0B,SAACI,IAAD,CAAU,CAClC,GAAQO,iBAAR,CAA6BP,IAA7B,CAAQO,gBAAR,CACAlB,aAAa,CAACmB,wBAAd,CAAuCD,gBAAvC,CAAyD,KAAzD,EACAjB,MAAM,CAACmB,IAAP,CAAY,WAAZ,CAAyB,CAAEF,gBAAgB,CAAEA,gBAApB,CAAzB,EACD,CAJD,EAMAjB,MAAM,CAACM,EAAP,CAAU,WAAV,CAAuB,SAACI,IAAD,CAAU,CAC/B,GAAQO,iBAAR,CAA6BP,IAA7B,CAAQO,gBAAR,CACAlB,aAAa,CAACmB,wBAAd,CAAuCD,gBAAvC,CAAyD,IAAzD,EACD,CAHD,EAKAjB,MAAM,CAACM,EAAP,CAAU,aAAV,CAAyB,SAACI,IAAD,CAAU,CACjCX,aAAa,CAACqB,mBAAd,CAAkCV,IAAlC,EACD,CAFD,EAIAV,MAAM,CAACM,EAAP,CAAU,uBAAV,CAAmC,SAACI,IAAD,CAAU,CAC3CH,OAAO,CAACC,GAAR,CAAY,gBAAZ,EACAT,aAAa,CAACsB,yBAAd,CAAwCX,IAAxC,EACD,CAHD,EAID,CA7DM,CA+DP,MAAO,IAAMY,kBAAiB,CAAG,QAApBA,kBAAoB,CAACZ,IAAD,CAAU,CACzCH,OAAO,CAACC,GAAR,CAAYE,IAAZ,EACAV,MAAM,CAACmB,IAAP,CAAY,gBAAZ,CAA8BT,IAA9B,EACD,CAHM,CAKP,MAAO,IAAMa,qBAAoB,CAAG,QAAvBA,qBAAuB,CAACb,IAAD,CAAU,CAC5CV,MAAM,CAACmB,IAAP,CAAY,qBAAZ,CAAmCT,IAAnC,EACD,CAFM,CAIP,MAAO,IAAMc,cAAa,CAAG,QAAhBA,cAAgB,EAAM,CACjCxB,MAAM,CAACmB,IAAP,CAAY,aAAZ,EACD,CAFM,CAIP,MAAO,IAAMM,SAAQ,CAAG,QAAXA,SAAW,CAACf,IAAD,CAAU,CAChCV,MAAM,CAACmB,IAAP,CAAY,WAAZ,CAAyBT,IAAzB,EACD,CAFM,CAIP,MAAO,IAAMgB,UAAS,CAAG,QAAZA,UAAY,CAAChB,IAAD,CAAU,CACjCV,MAAM,CAACmB,IAAP,CAAY,YAAZ,CAA0BT,IAA1B,EACD,CAFM,CAIP,MAAO,IAAMiB,eAAc,CAAG,QAAjBA,eAAiB,CAACjB,IAAD,CAAU,CACtCV,MAAM,CAACmB,IAAP,CAAY,aAAZ,CAA2BT,IAA3B,EACD,CAFM"},"metadata":{},"sourceType":"module"}